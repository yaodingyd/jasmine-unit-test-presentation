<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Unit Test with Jasmine</title>
		<meta name="description" content="unit test with Jasmine">
		<meta name="author" content="Yao Ding">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
    <style>
      .left {
        left:-8.33%;
        text-align: left;
        float: left;
        width:50%;
        z-index:-10;
      }

      .right {
        left:31.25%;
        top: 75px;
        float: right;
        text-align: right;
        z-index:-10;
        width:50%;
      }
    </style>

	</head>

	<body>
		<div class="reveal">
			<div class="slides">
				
        <section>
          <h1>Unit Testing with Jasmine</h1>
        </section>

        <section>
          <h2>What we will cover</h2>
          <ul>
            <li>Why Jasmine</li>
            <li>Project setup</li>
            <li>Make code testable</li>
            <li>Write test cases</li>
            <li>Maintainence on code</li>
          </ul>
        </section>

        <section>
          <img src="https://jasmine.github.io/images/jasmine-horizontal-small.png" alt="Documentation Home">
          <p>Jasmine is a behavior-driven development framework for testing JavaScript code with no dependencies, and can run in Node or browser.</p>
        </section>

        <section>
          <p>In a BDD style test you <strong>describe</strong> your code and tell the test what <strong>it</strong> should be doing.  Then you <strong>expect</strong> your code to do something.</p>

          <pre><code data-trim data-noescape>
            describe ( 'presentation.js' , function(){
              //what it should do
              it ( 'should be informative', function(){
                  //expect something 
                  expect( 
                      presentation.inform() 
                  ).toBeTruthy();
              )};
            } );
          </code></pre>
        </section>

        <section>
          <h4>Setting up Jasmine</h4>
          <ol>
            <li>Download <a href="https://github.com/jasmine/jasmine/releases/download/v2.5.2/jasmine-standalone-2.5.2.zip">Jasmine standalone package.</a></li>
            <li>Unzip it into a folder into project</li>
            <li>Add your source files to SpecRunner.html</li>
            <li>Create <strong>spec</strong> files and add them to SpecRunner.html</li>
            <li>Open SpecRunner.html in a browser.</li>
          </ol>
        </section>
        
        <section>
          <p>Folder Structure</p>
          <pre><code data-trim data-noescape>
            jasmine
            |--lib
            |  |--jasmine.js
            |  |--jasmine-jquery.js
            |--spec
            |  |--someSpec.js
            SpecRunner.html
          </code></pre>
          <p>Source file would be under js folder</p>
        </section>

        <section>
          <pre><code data-trim>
            //...following the default script
            <script src="lib/jquery-1.11.3/jquery.js"></script>
            <script src="lib/jasmine-jquery-2.1.1/jasmine-jquery.js"></script>  
            //source code
            <script src="js/validate/validate.js"></script>
            //spec files, test cases
            <script src="spec/setupSpec.js"></script>
            <script src="spec/librarySpec.js"></script>
            <script src="spec/rulesSpec.js"></script>
          </code></pre>
        </section>

        <section>
          <h2>Matchers</h2>
          <pre><code data-trim data-noescape>
            toBe( 'expected' )        //exact compare (===)
            toEqual( 'expected' )     //more general compare, can compare objects
            toBeDefined( )            //checks if var is not undefined
            toMatch( /regex/ )        //matches against regex
            toBeTruthy( )             //checks if var is truthy
            toBeLessThan( number )    //checks if value is less than number
          </code></pre>
          <p>Any matcher can be "reversed" by including the <strong class="red">not</strong> keyword.</p>
          <pre><code>expect( 5 ).not.toEqual( 3 );</code></pre>
        </section>

        <section>
          <h2>jasmine-jquery</h2>
          <p>A set of matchers and functions that help you test DOM elements</p>
          <pre><code data-trim data-noescape>
            toBeInDOM()
            toBeVisible()
            toContainHtml(string)
            toHaveClass(className)
          </code></pre>
        </section>

        <section>
          <h2>Spies</h2>
          <section>
            <p>Spies are utilities provided by jasmine to monitor function calls.</p>
          </section>
          <section>
            <p>A spy can stub any function and tracks calls to it and all arguments.</p>
          </section>
          <section>
            <p>use jasmine.createSpy() with jasmine.clock() jasmine.ajax() to handle asynchronous event</p>
          </section>
          <section>
            <p>To use it we tell Jasmine to <strong class="red">spyOn</strong> something. By default they are similar to mocks in other unit testing frameworks.</p>
          </section>
        </section>

        <section>
          <section>
            <pre><code data-trim>
              describe("A spy", function() {
                var foo, bar = null;

                beforeEach(function() {
                  foo = {
                    setBar: function(value) {
                      bar = value;
                    }
                  };

                  spyOn(foo, 'setBar');

                  foo.setBar(123);
                  foo.setBar(456, 'another param');
                });
              }
            </code></pre>
          </section>
          <section>
            <p>Using a spy</p>
            <pre><code data-trim>
              describe("A spy", function() {
                ...

                it("tracks that the spy was called", function() {
                  expect(foo.setBar).toHaveBeenCalled();
                });
              }
            </code></pre>
          </section>
        </section>

        <section>
          <h2>Spy matchers</h2>
          <p>validates that the method was called</p>
          <pre><code data-trim>
            expect( myObj.showOtherDiv ).toHaveBeenCalled();
          </code></pre>
          <p>validates that the method was called with specific arguments</p>
          <pre><code data-trim>
            expect( myObj.showOtherDiv ).toHaveBeenCalledWith( args );
          </code></pre>
        </section>

        <section>
          <h2>Organizing our code</h2>
          <p>Avoid these situations:</p>
          <section>
            <p>
              A general lack of structure; almost everything happens in one big function, and a lot of anonymous functions.
            </p>
          </section>
          <section>
            Complex functions: if a function is doing too much.
          </section>
          <section>
            Hidden or shared state: some important state or varible we need to test on but hidden in anonymous functions.
          </section>
        </section>

        <section>
          <p>An example of not testable code</p>
          <pre><code data-trim>
            $(document).ready(function(){
              var div1 = $('div.one'),
                  itemCount = getItemCount( 'li.item' );

              div1.on('click',function(){
                ...
              });

              div1.on('change', function(){
                ...
              });

              ...

              function getItemCount( selector ){
                return $( selector ).length;
              }
            });
          </code></pre>
        </section>

        <section>
          <p>Why not testable</p>
          <ul>
            <li>All the code is hidden in the $(document).ready() closure.</li>
            <li>The event handler is anonymous function passed directly into the on function.</li>
            <li>itemCount is hidden in closure.</li>
          </ul>
        </section>

        <section>
          <p>Make it more testable</p>
          <section>
            <div class="left">
              <pre><code data-trim>
                $().ready(function(){
                  //a bunch of codes
                  //doing first task
                  //doing second task
                })
              </code></pre>
            </div>
            <div class="right">
              <pre><code data-trim>
                function init() {
                  do1();
                  do2();
                  ...
                }
                
                function do1 () {}
                function do2 () {}
                ...
              </code></pre>
            </div>
          </section>

          <section>
            <div class="left">
              <pre><code data-trim>
                div1.on('click',function(){
                   ...
                });
              </code></pre>
            </div>
            <div class="right">
              <pre><code data-trim>
                function handleClick () {}

                div1.on('click', handleClick);
              </code></pre>
            </div>
          </section>

          <section>
            <div class="left">
              <pre><code data-trim>
                function do1() {
                  var someImportantVariable = value;
                }
              </code></pre>
            </div>
            <div class="right">
              <pre><code data-trim>
                var app = {
                  someImportantVariable = value,
                  ...
                }
              </code></pre>
            </div>
          </section>

          <section>
              <pre><code data-trim>
                var app = {
                  init : function(){
                    div1.on('click', this.handleDivClick);
                    div1.on('change', this.handleDivChange);
                    ...
                    this.itemCount = 
                        this.getItemCount( 'li.item' );
                  },

                  itemCount: 0,

                  getItemCount : function( selector ){
                    return $( selector ).length;
                  },

                  handleDivClick : function( e ){ ... }

                  handleDivChange : function() { ...}

                  ...
                };
              </code></pre>
          </section>
        </section>

        <section>
          <section>
            <p>Good Practices on Writing test cases</p>
            <p>General guidelines</p>
            <ul>
              <li>Lightweight</li>
              <li>Repeatable</li>
              <li>Fast</li>
              <li>Consistent</li>
              <li>Easy to write and read</li>
            </ul>
          </section>
          <section>
            <p>Make each test isolated and independent to all the others</p>
            <p>Any given behaviour should be specified in one and only one test</p>
            <p>The execution/order of execution of one test cannot affect the others</p>
          </section>
          <section>
            <p>Each test should only test one code unit</p>
            <p>Don't test multiple concerns in the same test</p>
            <pre><code data-trim>
              it('should properly validate and update error message', function(){...})
              
              it('should properly valudate', function(){...})
              it('should update error message', function(){...})
            </code></pre>
          </section>
          <section>
            <p>Setup properly the actions that apply to all the tests involved</p>
            <pre><code>
              beforeEach, afterEach, beforeAll, afterAll
            </code></pre>
          </section>
          <section>
            <p>Name  unit tests clearly and consistently</p>
            <p>All the <mark>describe</mark> and <mark>it</mark> should be informative</p>
          </section>
        </section>

        <section>
          <p>Maintainence</p>
          <ul>
            <li>Always run regression test when refactoring code</li>
            <li>Add unit test when adding new functionality</li>
            <li>Create new tests for every defect</li>
          </ul>
        </section>

        <section>
          <h2>References</h2>
          <a href="https://github.com/mawrkus/js-unit-testing-guide">https://github.com/mawrkus/js-unit-testing-guide</a>
        </section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>
		<script>
			Reveal.initialize({
        width: 1280,
				controls: true,
				progress: true,
				history: true,
				center: true,
				transition: 'slide', // none/fade/slide/convex/concave/zoom
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});
		</script>

	</body>
</html>
